(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();class O{constructor(i,e=1e3/60){this.accumulatorMs=0,this.lastTime=0,this.rafId=null,this.running=!1,this.callbacks=i,this.fixedStepMs=e}start(){if(this.running)return;this.running=!0,this.lastTime=performance.now();const i=()=>{if(!this.running)return;const e=performance.now();let o=e-this.lastTime;for(o>1e3&&(o=this.fixedStepMs),this.lastTime=e,this.accumulatorMs+=o;this.accumulatorMs>=this.fixedStepMs;)this.callbacks.update(this.fixedStepMs),this.accumulatorMs-=this.fixedStepMs;this.callbacks.render(),this.rafId=requestAnimationFrame(i)};this.rafId=requestAnimationFrame(i)}stop(){this.running=!1,this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=null}}const W={left:["ArrowLeft"],right:["ArrowRight"],softDrop:["ArrowDown"],hardDrop:[" "],rotateCW:["x","X","ArrowUp"],rotateCCW:["z","Z"],hold:["c","C"],pause:["p","P"],restart:["r","R"]};class A{constructor(i={}){this.onKeyDown=e=>{this.match(e,this.bindings.left)&&(this.state.left=!0),this.match(e,this.bindings.right)&&(this.state.right=!0),this.match(e,this.bindings.softDrop)&&(this.state.softDrop=!0),this.match(e,this.bindings.hardDrop)&&(this.state.hardDrop=!0),this.match(e,this.bindings.rotateCW)&&(this.state.rotateCW=!0),this.match(e,this.bindings.rotateCCW)&&(this.state.rotateCCW=!0),this.match(e,this.bindings.hold)&&(this.state.hold=!0),this.match(e,this.bindings.pause)&&(this.state.pause=!0),this.match(e,this.bindings.restart)&&(this.state.restart=!0)},this.onKeyUp=e=>{this.match(e,this.bindings.left)&&(this.state.left=!1),this.match(e,this.bindings.right)&&(this.state.right=!1),this.match(e,this.bindings.softDrop)&&(this.state.softDrop=!1),this.match(e,this.bindings.hardDrop)&&(this.state.hardDrop=!1),this.match(e,this.bindings.rotateCW)&&(this.state.rotateCW=!1),this.match(e,this.bindings.rotateCCW)&&(this.state.rotateCCW=!1),this.match(e,this.bindings.hold)&&(this.state.hold=!1),this.match(e,this.bindings.pause)&&(this.state.pause=!1),this.match(e,this.bindings.restart)&&(this.state.restart=!1)},this.bindings={...W,...i},this.state={left:!1,right:!1,softDrop:!1,hardDrop:!1,rotateCW:!1,rotateCCW:!1,hold:!1,pause:!1,restart:!1}}attach(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}detach(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}consume(i){const e=this.state[i];return this.state[i]=!1,e}match(i,e){return e.includes(i.key)}}const b={I:"#5dd1ff",O:"#ffd95d",T:"#b85dff",S:"#5dff9e",Z:"#ff5d87",J:"#5d83ff",L:"#ffa35d"},R={I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],O:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],T:[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],S:[[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],Z:[[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]]],J:[[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]]],L:[[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]]};function C(t){return R[t.type][t.rotation]}function*B(){const t=["I","O","T","S","Z","J","L"];for(;;){const i=[...t];for(let e=i.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[i[e],i[o]]=[i[o],i[e]]}for(const e of i)yield e}}const h=10,d=22;function K(){return Array.from({length:d},()=>Array(h).fill(0))}function I(){const t=B(),i={field:K(),active:null,hold:null,holdLocked:!1,queue:[],bag:t,score:0,level:1,lines:0,gravityMs:1e3,gravityTimer:0,lockDelayMs:500,lockTimer:0,status:"playing"};return T(i),y(i),i}function T(t){for(;t.queue.length<5;)t.queue.push(t.bag.next().value)}function y(t){const i=t.queue.shift();T(t);const e={type:i,rotation:0,x:3,y:0};if(m(t,e)){t.status="gameover";return}t.active=e,t.holdLocked=!1}function q(t,i){let e=i.y;for(;!m(t,{...i,y:e+1});)e++;return e}function g(t,i,e){if(!t.active)return!1;const o={...t.active,x:t.active.x+i,y:t.active.y+e};return m(t,o)?!1:(t.active=o,!0)}function w(t,i){if(!t.active)return!1;const e=((t.active.rotation+i)%4+4)%4,o=F(t.active.type,t.active.rotation,e);for(const[n,r]of o){const s={...t.active,rotation:e,x:t.active.x+n,y:t.active.y+r};if(!m(t,s))return t.active=s,!0}return!1}function F(t,i,e){const o=[[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]]],n=[[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]]];if(t==="O")return[[0,0]];const r=t==="I"?n:o,s=i===0&&e===1||i===1&&e===2||i===2&&e===3||i===3&&e===0?i%4:(i+3)%4;return r[s]}function m(t,i){const e=C(i);for(let o=0;o<4;o++)for(let n=0;n<4;n++){if(!e[o][n])continue;const r=i.x+n,s=i.y+o;if(r<0||r>=h||s>=d||s>=0&&t.field[s][r])return!0}return!1}function Z(t,i){if(t.status!=="playing")return;t.gravityTimer+=i;let e=!1;for(;t.gravityTimer>=t.gravityMs;)t.gravityTimer-=t.gravityMs,e=g(t,0,1)||e;e?t.lockTimer=0:t.active&&m(t,{...t.active,y:t.active.y+1})?(t.lockTimer+=i,t.lockTimer>=t.lockDelayMs&&(x(t),S(t),D(t),y(t),t.lockTimer=0)):t.lockTimer=0}function H(t){if(!t.active||t.holdLocked)return;const i=t.active.type;if(t.hold===null)t.hold=i,y(t);else{const e=t.hold;t.hold=i,t.active={type:e,rotation:0,x:3,y:0},m(t,t.active)&&(t.status="gameover")}t.holdLocked=!0}function J(t){t.active&&(t.active.y=q(t,t.active),x(t),S(t),D(t),y(t),t.lockTimer=0)}function x(t){if(!t.active)return;const i=C(t.active);for(let e=0;e<4;e++)for(let o=0;o<4;o++){if(!i[e][o])continue;const n=t.active.x+o,r=t.active.y+e;r>=0&&r<d&&n>=0&&n<h&&(t.field[r][n]=t.active.type)}t.active=null}function S(t){let i=0;for(let e=d-1;e>=0;e--)t.field[e].every(o=>o!==0)&&(t.field.splice(e,1),t.field.unshift(Array(h).fill(0)),i++,e++);i>0&&(t.lines+=i,t.score+=G(i,t.level))}function G(t,i){return([0,100,300,500,800][t]??0)*i}function D(t){t.level=Math.floor(t.lines/10)+1,t.gravityMs=Math.max(60,1e3-(t.level-1)*80)}function k(t){const i=I();Object.assign(t,i)}const f=32;function U(t,i){N(t,i.board),Y(t,i.next),_(t,i.hold),i.scoreEl.textContent=String(t.score),i.levelEl.textContent=String(t.level),i.linesEl.textContent=String(t.lines)}function N(t,i){const e=i.getContext("2d");e.clearRect(0,0,i.width,i.height),e.fillStyle="#111433";for(let o=0;o<d-2;o++)for(let n=0;n<h;n++)e.fillRect(n*f+1,o*f+1,f-2,f-2);for(let o=2;o<d;o++)for(let n=0;n<h;n++){const r=t.field[o][n];r&&L(e,n,o-2,b[r])}if(t.active){const o=C(t.active);for(let n=0;n<4;n++)for(let r=0;r<4;r++){if(!o[n][r])continue;const s=t.active.x+r,l=t.active.y+n-2;l>=0&&L(e,s,l,b[t.active.type])}}}function L(t,i,e,o){const r=i*f,s=e*f;t.fillStyle=o,E(t,r+1,s+1,f-2,f-2,8),t.fill();const l=t.createLinearGradient(r,s,r,s+f);l.addColorStop(0,"rgba(255,255,255,0.25)"),l.addColorStop(1,"rgba(0,0,0,0.25)"),t.fillStyle=l,E(t,r+1,s+1,f-2,f-2,8),t.fill()}function E(t,i,e,o,n,r){t.beginPath(),t.moveTo(i+r,e),t.arcTo(i+o,e,i+o,e+n,r),t.arcTo(i+o,e+n,i,e+n,r),t.arcTo(i,e+n,i,e,r),t.arcTo(i,e,i+o,e,r),t.closePath()}function Y(t,i){const e=i.getContext("2d");e.clearRect(0,0,i.width,i.height);const o=20,n=10;t.queue.slice(0,5).forEach((r,s)=>{M(e,r,n,s*(o*3)+n,o)})}function _(t,i){const e=i.getContext("2d");e.clearRect(0,0,i.width,i.height),t.hold&&M(e,t.hold,10,10,20)}function M(t,i,e,o,n){const r=b[i],s={I:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],O:[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],T:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],S:[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],Z:[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],J:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],L:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]]};for(let l=0;l<4;l++)for(let p=0;p<4;p++)s[i][l][p]&&(t.fillStyle=r,t.fillRect(e+p*n+1,o+l*n+1,n-2,n-2))}const j=document.getElementById("board"),Q=document.getElementById("next"),z=document.getElementById("hold"),X=document.getElementById("score"),$=document.getElementById("level"),V=document.getElementById("lines"),v=document.getElementById("btn-pause"),t0=document.getElementById("btn-restart"),e0={board:j,next:Q,hold:z,scoreEl:X,levelEl:$,linesEl:V},a=new A;a.attach();const c=I();let u=!1;v.addEventListener("click",()=>P());t0.addEventListener("click",()=>{k(c),u=!1,v.textContent="Pause"});function P(){u=!u,v.textContent=u?"Resume":"Pause"}function i0(){if(a.consume("pause")&&P(),a.consume("restart")&&(k(c),u=!1,v.textContent="Pause"),u||c.status!=="playing")return;const t=a.consume("left"),i=a.consume("right");t&&g(c,-1,0),i&&g(c,1,0),a.consume("softDrop")&&g(c,0,1),a.consume("rotateCW")&&w(c,1),a.consume("rotateCCW")&&w(c,-1),a.consume("hardDrop")&&J(c),a.consume("hold")&&H(c)}const n0=new O({update:t=>{i0(),u||Z(c,t)},render:()=>U(c,e0)});n0.start();
