import"./modulepreload-polyfill-B5Qt9EMX.js";import{I as L,c as k,r as S,G as B,a as _,t as $,m as g,b as C,h as H,d as N,l as E,q as P,e as T,f as A,g as D}from"./scoreboard-dJYpJN6-.js";const R=document.getElementById("board"),M=document.getElementById("next"),G=document.getElementById("hold"),q=document.getElementById("score"),W=document.getElementById("level"),z=document.getElementById("lines"),h=document.getElementById("btn-pause"),F=document.getElementById("btn-restart"),I=document.getElementById("single-scoreboard"),O={board:R,next:M,hold:G,scoreEl:q,levelEl:W,linesEl:z},s=new L;s.attach();const t=k();let d=!1,x=t.status;h.addEventListener("click",()=>v());F.addEventListener("click",()=>{S(t),d=!1,h.textContent="Pause"});function v(){d=!d,h.textContent=d?"Resume":"Pause"}function j(){if(s.consume("pause")&&v(),s.consume("restart")&&(S(t),d=!1,h.textContent="Pause"),d||t.status!=="playing")return;const e=s.consume("left"),l=s.consume("right");e&&g(t,-1,0),l&&g(t,1,0),s.consume("softDrop")&&g(t,0,1),s.consume("rotateCW")&&C(t,1),s.consume("rotateCCW")&&C(t,-1),s.consume("hardDrop")&&H(t),s.consume("hold")&&N(t)}const J=new B({update:e=>{j(),d||$(t,e),x!==t.status&&(t.status==="gameover"&&K(),x=t.status)},render:()=>_(t,O)});J.start();function K(){const e=t.score,l=E();if(P(e,l)){const m=(localStorage.getItem("tetris_player_name")||"").trim(),o=(localStorage.getItem("tetris_nick")||"").trim();T(m||o||"Anonymous",e,{level:t.level,lines:t.lines})}I&&A(I,E());try{window.dispatchEvent(new CustomEvent("tetris:score-updated"))}catch{}}window.__tetris={getStatus:()=>t.status,isPaused:()=>d,pause:()=>{d||v()}};const f=document.getElementById("btn-back");f==null||f.addEventListener("click",()=>{var m;const e=window.__tetris;if(e&&e.getStatus&&e.getStatus()==="playing"&&!((m=e.isPaused)!=null&&m.call(e))){const o=document.createElement("div");o.style.cssText="position:fixed;inset:0;background:rgba(0,0,0,0.5);display:grid;place-items:center;z-index:2000;";const a=document.createElement("div");a.className="panel",a.style.cssText="width:min(420px,92vw);",a.innerHTML='<h2 style="margin:0 0 8px;">게임을 멈추고 나가시겠습니까?</h2><p class="muted" style="margin:0 0 12px;">진행 중인 게임은 일시정지됩니다.</p>';const c=document.createElement("div");c.className="row";const r=document.createElement("button");r.textContent="취소";const i=document.createElement("button");i.textContent="나가기",c.appendChild(r),c.appendChild(i),a.appendChild(c),o.appendChild(a),document.body.appendChild(o),r.addEventListener("click",()=>document.body.removeChild(o)),i.addEventListener("click",()=>{var u;try{(u=e.pause)==null||u.call(e)}catch{}location.href="../index.html"})}else location.href="../index.html"});(function(){const e=(localStorage.getItem("tetris_nick")||"").trim()||"Anonymous",l=document.getElementById("nick-badge");l&&(l.textContent=`닉네임: ${e}`)})();function w(){const e=document.getElementById("single-scoreboard");if(!e)return;e.innerHTML="";const m=E().sort((n,p)=>p.score-n.score||p.date.localeCompare(n.date)).slice(0,10),o=localStorage.getItem("tetris_player_name")||localStorage.getItem("tetris_nick")||"",a=D(o||""),c=document.createElement("div");c.className="single-sb-header";const r=document.createElement("div");r.className="single-sb-title",r.textContent="싱글 하이스코어 Top 10";const i=document.createElement("div");i.className="single-sb-rank",i.textContent=o?a?`내 순위: ${a}위`:"내 순위: 기록 없음":"내 순위: 닉네임이 설정되지 않았습니다",c.appendChild(r),c.appendChild(i),e.appendChild(c);const u=document.createElement("table");u.innerHTML='<thead><tr><th class="num">#</th><th>Name</th><th class="num">Score</th><th class="num">Level</th><th class="num">Lines</th><th class="num">Date</th></tr></thead>';const y=document.createElement("tbody");m.forEach((n,p)=>{const b=document.createElement("tr");b.innerHTML=`<td class="num">${p+1}</td><td>${n.name}</td><td class="num">${n.score.toLocaleString()}</td><td class="num">${typeof n.level=="number"?n.level:""}</td><td class="num">${typeof n.lines=="number"?n.lines:""}</td><td class="num">${new Date(n.date).toLocaleString()}</td>`,y.appendChild(b)}),u.appendChild(y),e.appendChild(u)}w();window.addEventListener("tetris:score-updated",w);
